<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ahmed Adel Game</title>
  <style>
    :root {
      --bg1: #b3ecff;
      --bg2: #c4f0ff;
      --ground: #6fbf44;
      --pipe: #2c9c3a;
      --badge: #ffffffaa;
      --badgeText: #03314b
    }
    html, body { height:100%; margin:0; }
    body {
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      font-family:system-ui; -webkit-font-smoothing:antialiased;
    }
    #wrap { position:relative; width:420px; max-width:95vw; }
    canvas {
      display:block; width:100%; height:auto;
      border-radius:10px; touch-action:none; background:transparent;
    }
    .scoreBadge {
      position:absolute; left:50%; transform:translateX(-50%);
      top:10px; background:var(--badge); padding:8px 14px;
      border-radius:22px; display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      box-shadow:0 6px 18px rgba(0,0,0,0.12);
      user-select:none; pointer-events:none;
    }
    .scoreNum { font-weight:800; font-size:28px; color:var(--badgeText); line-height:1; }
    .bestNum { font-size:12px; color:var(--badgeText); opacity:0.9; margin-top:3px; }
    @media (max-width:420px){ .scoreNum{ font-size:22px } }
    .overlay {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      pointer-events:none;
    }
    .modal {
      pointer-events:auto; background:rgba(255,255,255,0.98);
      padding:18px; border-radius:12px; max-width:90%; text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.15);
    }
    .modal h3{ margin:0 0 8px 0 }
    .modal p{ margin:6px 0; line-height:1.4 }
    .btn {
      background:#2c9c3a; color:white; border:none;
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700
    }
    .btn:active { transform:translateY(1px) }
    .heart {
      font-size: 60px;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
  </style>
</head>

<body>
  <div id="wrap">
    <canvas id="c" width="400" height="600" aria-label="Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©"></canvas>
    <div class="scoreBadge" aria-hidden="true">
      <div class="scoreNum" id="scoreDisplay">0</div>
      <div class="bestNum" id="bestDisplay">Ø£ÙØ¶Ù„: 0</div>
    </div>
    <div class="overlay" id="overlay" aria-hidden="true" style="display:none">
      <div class="modal" id="modal"></div>
    </div>
  </div>
  <audio id="crySound" src="./audio/cry.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const scoreDisplay = document.getElementById('scoreDisplay');
    const bestDisplay = document.getElementById('bestDisplay');
    const crySound = document.getElementById("crySound");

    const imgPlay = new Image(); imgPlay.src = './img/play.png';
    const imgCry = new Image(); imgCry.src = './img/cry.png';

    let dpr = window.devicePixelRatio || 1;
    canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
    canvas.width = W * dpr; canvas.height = H * dpr;
    ctx.scale(dpr, dpr);

     let gravity = 0.6, flapStrength = -8.6;
    let pipeSpeed = 5, pipeGap = 160, pipeWidth = 72;
    let spawnInterval = 85, frame = 0;

     const player = { x:100, y:H/2, w:52, h:52, vy:0 };
    let pipes = []; let running=false, isGameOver=false;
    let score=0, best=Number(localStorage.getItem('flappy_best_v2')||0);
    bestDisplay.textContent='Ø£ÙØ¶Ù„: '+best;

    let sessionBirthdayShown = false;

      function updateSpeed(){
      if(score > 0 && score % 3 === 0){   // ÙƒÙ„ 5 Ù†Ù‚Ø§Ø·
        pipeSpeed += 0.4;                 // Ø²ÙˆÙ‘Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø©
        // Ø¹Ø´Ø§Ù† Ù…Ø§ÙŠØ²ÙˆØ¯Ø´ Ø§ÙƒØªØ± Ù…Ù† Ù…Ø±Ø© Ø¹Ù†Ø¯ Ù†ÙØ³ Ø§Ù„Ù†Ù‚Ø·Ø©
        score += 1;  // Ù†Ø²ÙˆØ¯ Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø© Ø²ÙŠØ§Ø¯Ø© Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„ØªÙƒØ±Ø§Ø±
      }
    }
    // ===== fireworks system =====
    let fireworksActive = false;
    const rockets = [];    
    const particles = [];  

    function spawnRocket(){
      const x = Math.random() * (W * 0.8) + W*0.1;
      const vy = - (3 + Math.random()*2.4);
      const targetY = H * (0.25 + Math.random()*0.4);
      rockets.push({ x, y: H, vy, targetY, color: randColor(), trail: [] });
    }

    function randColor(){
      const palette = ['#ff4d4d','#ffd24d','#7aff7a','#7ad2ff','#d97aff','#ff7abf'];
      return palette[Math.floor(Math.random()*palette.length)];
    }

    function explodeRocket(r){
      const count = 18 + Math.floor(Math.random()*20);
      for(let i=0;i<count;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 1 + Math.random()*4;
        particles.push({
          x: r.x,
          y: r.y,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed,
          life: 60 + Math.floor(Math.random()*40),
          color: r.color,
          age:0,
          size: 1 + Math.random()*2
        });
      }
    }

    function updateFireworks(){
      if(fireworksActive && frame % 12 === 0){
        if(rockets.length < 6) spawnRocket();
      }
      for(let i=rockets.length-1;i>=0;i--){
        const r = rockets[i];
        r.y += r.vy;
        r.vy -= 0.06; 
        r.trail.push({x:r.x, y:r.y});
        if(r.trail.length>12) r.trail.shift();

        if(r.y < r.targetY || r.vy > -0.5){
          explodeRocket(r);
          rockets.splice(i,1);
        }
      }
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.vy += 0.06; 
        p.x += p.vx;
        p.y += p.vy;
        p.age++;
        if(p.age > p.life){
          particles.splice(i,1);
        }
      }
    }

    function drawFireworks(){
      ctx.save();
      ctx.globalCompositeOperation = 'lighter'; 
      for(const r of rockets){
        for(let t=0;t<r.trail.length;t++){
          const pt = r.trail[t];
          const alpha = (t / r.trail.length) * 0.6;
          ctx.beginPath();
          ctx.fillStyle = r.color;
          ctx.globalAlpha = alpha*0.8;
          ctx.arc(pt.x, pt.y, 2 + t*0.12, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.beginPath();
        ctx.globalAlpha = 1;
        ctx.arc(r.x, r.y, 3, 0, Math.PI*2);
        ctx.fillStyle = '#fff';
        ctx.fill();
        ctx.beginPath();
        ctx.globalAlpha = 0.9;
        ctx.arc(r.x, r.y, 2, 0, Math.PI*2);
        ctx.fillStyle = r.color;
        ctx.fill();
      }
      for(const p of particles){
        const t = p.age / p.life;
        ctx.globalAlpha = Math.max(0, 1 - t);
        ctx.beginPath();
        ctx.fillStyle = p.color;
        const size = p.size * (1 + 0.6*(1-t));
        ctx.arc(p.x, p.y, size, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
      ctx.globalCompositeOperation = 'source-over';
      ctx.restore();
    }
    // ===== end fireworks system =====

    function reset(){
      pipes=[]; player.y=H/2; player.vy=0;
      frame=0; running=false; isGameOver=false; score=0;
      rockets.length = 0; particles.length = 0;
      fireworksActive = false;
      updateScoreUI();
    }
    reset();

    function flapNow(){
      if(isGameOver){ reset(); return; }
      if(!running) running=true;
      player.vy=flapStrength;
    }
    window.addEventListener('keydown',e=>{
      if(e.code==='Space'||e.code==='ArrowUp'){e.preventDefault(); flapNow();}
    });
    canvas.addEventListener('mousedown',e=>{e.preventDefault(); flapNow();});
    canvas.addEventListener('touchstart',e=>{e.preventDefault(); flapNow();},{passive:false});

    function spawnPipe(){
      const margin=60, maxTop=H-pipeGap-margin;
      const top=Math.floor(Math.random()*(maxTop-margin))+margin;
      pipes.push({x:W+20, top, passed:false});
    }
    function updateScoreUI(){ scoreDisplay.textContent=score; bestDisplay.textContent='Ø£ÙØ¶Ù„: '+best; }

    function update(){
      frame++;
      if(fireworksActive){
        updateFireworks();
      } else {
        if(particles.length>0) updateFireworks();
      }

      if(running&&!isGameOver){
        if(frame%spawnInterval===0) spawnPipe();
        player.vy+=gravity; player.y+=player.vy;

        for(let i=pipes.length-1;i>=0;i--){
          const p=pipes[i]; p.x-=pipeSpeed;
          if(!p.passed && (p.x+pipeWidth)<player.x-6){
            p.passed=true; score++;

            // âœ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø©
            updateSpeed();
             if(score % 5 === 0){
    crySound.currentTime = 0;
    crySound.play().catch(()=>{});
  }


            if(score>best){ best=score; localStorage.setItem('flappy_best_v2',best); }
            updateScoreUI();
          }
          if(p.x+pipeWidth<-50) pipes.splice(i,1);
        }

        if(player.y+player.h/2>=H-20){ player.y=H-20-player.h/2; endGame(); }
        if(player.y-player.h/2<=0){ player.y=player.h/2; player.vy=0; }

        for(const p of pipes){
          const inX=player.x+player.w/2>p.x&&player.x-player.w/2<p.x+pipeWidth;
          if(inX){
            const above=player.y-player.h/2<p.top;
            const below=player.y+player.h/2>p.top+pipeGap;
            if(above||below){ endGame(); break; }
          }
        }
      }
    }
    function endGame(){ isGameOver = true;
    running = false;

    // Ø´ØºÙ„ ØµÙˆØª Ø§Ù„Ø¨ÙƒØ§Ø¡
      showModal(`
      <h3> Ø®Ø³Ø±Øª ÙŠ ÙˆØ³Ø³Ø³Ø³Ø³Ø®! ğŸ˜¢</h3>
       <video width="300" autoplay >
      <source src="./audio/ahmed.mp4" type="video/mp4">
      Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
    </video>
      <p>Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}</p>
      <p><button class='btn' onclick="restart();">Ø¥Ø¹Ø§Ø¯Ø©</button></p>
    `);
    }
     function restart(){
    hideModal();

    // â¹ï¸ ÙˆÙ‚Ù ØµÙˆØª Ø§Ù„Ø¨ÙƒØ§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©
  

    pipes = [];
    score = 0;
    player.y = H/2;
    player.vy = 0;
    isGameOver = false;
    running = true;
    updateScoreUI();
  }

    function draw(){
      ctx.clearRect(0,0,W,H);
      const grad=ctx.createLinearGradient(0,0,0,H);
      grad.addColorStop(0,'#a6e0ff'); grad.addColorStop(1,'#dff9ff');
      ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);

      drawFireworks();

      for(const p of pipes){
        ctx.fillStyle='#2c9c3a';
        ctx.fillRect(p.x,0,pipeWidth,p.top);
        ctx.fillRect(p.x,p.top+pipeGap,pipeWidth,H-(p.top+pipeGap)-20);
      }
      ctx.fillStyle='#6fbf44'; ctx.fillRect(0,H-20,W,20);

      ctx.save(); ctx.translate(player.x,player.y);
      const img=isGameOver?imgCry:imgPlay;
      if(img.complete&&img.naturalWidth!==0){
        ctx.beginPath(); const r=Math.min(player.w,player.h)/2;
        ctx.arc(0,0,r,0,Math.PI*2); ctx.closePath(); ctx.clip();
        ctx.drawImage(img,-player.w/2,-player.h/2,player.w,player.h);
      } else {
        ctx.fillStyle='#ffcc00'; roundRect(ctx,-player.w/2,-player.h/2,player.w,player.h,10,true,false);
      }
      ctx.restore();
    }

    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); if(fill)ctx.fill(); if(stroke)ctx.stroke();
    }

    function loop(){ update(); draw(); requestAnimationFrame(loop); }
    requestAnimationFrame(loop);
    updateScoreUI();

    const overlay=document.getElementById('overlay');
    const modal=document.getElementById('modal');
    function showModal(html){overlay.style.display='flex';overlay.setAttribute('aria-hidden','false');modal.innerHTML=html;}
    function hideModal(){overlay.style.display='none';overlay.setAttribute('aria-hidden','true');modal.innerHTML='';}

    function continueGame(){
      hideModal();
      bdaySound.pause();         
      bdaySound.currentTime = 0; 
      fireworksActive = false;
      rockets.length = 0; particles.length = 0;
      running=true;
    }
  </script>
</body>
</html>

